/*
 * knocheck_GloVar.h
 *
 *  Created on: 2015. 6. 15.
 *      Author: hansteve
 */

#include <knocheck_config.h>
#include <knocheck_def.h>
#include <knocheck_Switch.h>
#include "Ifx_Types.h"			/* will be changed to header*/
#ifdef KNOCHECK_TEST
	__align (4)
	uint8 	FilterIndices[KNK_PARALLELFILTER_SIZE] ={0,1,2};
#endif
	/*End of KNOCHECK_TEST*/

#ifdef KNOCHECK_TEST
	uint8 	Errortrace;
#endif
	/*End of KNOCHECK_TEST*/

__align (2*BUFFER_SIZE)
volatile sint16 Buffer0_Dest[BUFFER_SIZE];
__align (2*BUFFER_SIZE)
volatile sint16 Buffer1_Dest[BUFFER_SIZE];

#pragma section neardata
uint8 KnoCheck_NumBuffer;
uint8 KnoCheck_IgnDataCnt;
uint8 Knocheck_Ready_Chan;
uint8 KnoCheck_RunChan;
uint8 KnoCheck_RunFiltNum;
uint16 KnoCheck_FirNumInput;
uint8 KnoCheck_Gain[MAX_CHANNEL];
KNOCHECK_ISR_FLAG KnoCheck_IsrDistFlg;
KNOCHECK_CONVAR KnoCheck_WinCon[MAX_CHANNEL];
KNOCHECK_CIRBUFF Knocheck_FiltInfo[MAX_CHANNEL][KNK_PARALLELFILTER_SIZE];
#pragma section neardata restore

	#pragma section neardata
	#pragma align 8
	sint16 Knocheck_DestCopyRam[BUFFER_SIZE];
#pragma align restore
	sint16 Knocheck_FilterResult[KNK_PARALLELFILTER_SIZE][BUFFER_SIZE];

	sint16 Knocheck_Integr[KNK_PARALLELFILTER_SIZE][BUFFER_SIZE];
	sint32 Knocheck_Integrated[MAX_CHANNEL][KNK_PARALLELFILTER_SIZE];
	uint16 Knocheck_NumIputData;
	#pragma section neardata restore

#pragma section neardata
/* Input: Data in 1Q15 */
#pragma align 8
	sint16 KNK_DETECTION_FILTER_SET[KNK_FILTERSET_SIZE][KNOCHECK_FILTER_ORDER] = {
			// Filter1: 8 kHz
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter3: 12 kHz
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter4: 14 kHz
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter5: 16 kHz
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter6: 18 kz
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter7: 20 kHz
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter8: 7 kHz narrowband
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter9: 8 kHz narrowband
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter10: 10 kHz narrowband
			{
				0x8000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000,
				0x0000,0x0000,0x0000,0x0000
			},
					// Filter11 : Bypass
					{ 32767, 0, 0, 0, }

			};

/* Filter delayLine */
#pragma align 8
sint16  Coeff_Dly[KNK_PARALLELFILTER_SIZE][KNOCHECK_FILTER_ORDER];
/* CircBuf for Filter Coefficients (Coeff) */
KNOCHECK_CIRBUFF cptr_Coeff= {KNK_DETECTION_FILTER_SET, 0, KNOCHECK_FILTER_ORDER*2};
/* CircBuf for delayLine */
KNOCHECK_CIRBUFF cptr_Coeff_Dly_0 = {Coeff_Dly[0], 0, KNOCHECK_FILTER_ORDER*2};
KNOCHECK_CIRBUFF cptr_Coeff_Dly_1 = {Coeff_Dly[1], 0, KNOCHECK_FILTER_ORDER*2};
KNOCHECK_CIRBUFF cptr_Coeff_Dly_2 = {Coeff_Dly[2], 0, KNOCHECK_FILTER_ORDER*2};
#pragma section neardata restore
